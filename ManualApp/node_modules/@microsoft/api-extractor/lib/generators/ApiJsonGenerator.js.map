{"version":3,"sources":["generators/ApiJsonGenerator.ts"],"names":[],"mappings":"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","file":"generators/ApiJsonGenerator.js","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as os  from 'os';\r\nimport * as path from 'path';\r\nimport * as ts from 'typescript';\r\nimport { JsonFile, JsonSchema, IJsonSchemaErrorInfo } from '@microsoft/node-core-library';\r\n\r\nimport Extractor from '../Extractor';\r\nimport AstStructuredType from '../ast/AstStructuredType';\r\nimport AstEnum from '../ast/AstEnum';\r\nimport AstEnumValue from '../ast/AstEnumValue';\r\nimport AstFunction from '../ast/AstFunction';\r\nimport AstItem, { AstItemKind } from '../ast/AstItem';\r\nimport AstItemVisitor from './AstItemVisitor';\r\nimport AstPackage from '../ast/AstPackage';\r\nimport AstParameter from '../ast/AstParameter';\r\nimport AstProperty from '../ast/AstProperty';\r\nimport AstMember, { ApiAccessModifier } from '../ast/AstMember';\r\nimport AstNamespace from '../ast/AstNamespace';\r\nimport AstModuleVariable from '../ast/AstModuleVariable';\r\nimport AstMethod from '../ast/AstMethod';\r\nimport { ReleaseTag } from '../aedoc/ReleaseTag';\r\nimport { IApiReturnValue, IApiParameter } from '../api/ApiItem';\r\nimport ApiJsonFile from '../api/ApiJsonFile';\r\n\r\n/**\r\n * For a library such as \"example-package\", ApiFileGenerator generates the \"example-package.api.json\"\r\n * file which represents the API surface for that package.  This file should be published as part\r\n * of the library's NPM package.  API Extractor will read this file later when it is analyzing\r\n * another project that consumes the library.  (Otherwise, API Extractor would have to re-analyze all\r\n * the *.d.ts files, which would be bad because the compiler definitions might not be available for\r\n * a published package, or the results of the analysis might be different somehow.)  Documentation\r\n * tools such as api-documenter can also use the *.api.json files.\r\n *\r\n * @public\r\n */\r\nexport default class ApiJsonGenerator extends AstItemVisitor {\r\n  private static _methodCounter: number = 0;\r\n  private static _MEMBERS_KEY: string = 'members';\r\n  private static _EXPORTS_KEY: string = 'exports';\r\n  private static _jsonSchema: JsonSchema | undefined = undefined;\r\n\r\n  /**\r\n   * The JSON schema for the *.api.json file format.\r\n   */\r\n  public static get jsonSchema(): JsonSchema {\r\n    if (!ApiJsonGenerator._jsonSchema) {\r\n      ApiJsonGenerator._jsonSchema = JsonSchema.fromFile(path.join(__dirname, '../api/api-json.schema.json'));\r\n    }\r\n\r\n    return ApiJsonGenerator._jsonSchema;\r\n  }\r\n\r\n  protected jsonOutput: Object = {};\r\n\r\n  public writeJsonFile(reportFilename: string, extractor: Extractor): void {\r\n    this.visit(extractor.package, this.jsonOutput);\r\n\r\n    // Write the output before validating the schema, so we can debug it\r\n    JsonFile.save(this.jsonOutput, reportFilename);\r\n\r\n    // Validate that the output conforms to our JSON schema\r\n    ApiJsonGenerator.jsonSchema.validateObjectWithCallback(this.jsonOutput, (errorInfo: IJsonSchemaErrorInfo) => {\r\n      const errorMessage: string = path.basename(reportFilename)\r\n        + ` does not conform to the expected schema -- please report this API Extractor bug:`\r\n        + os.EOL + errorInfo.details;\r\n\r\n      console.log(os.EOL + 'ERROR: ' + errorMessage + os.EOL + os.EOL);\r\n      throw new Error(errorMessage);\r\n    });\r\n  }\r\n\r\n  // @override\r\n  protected visit(astItem: AstItem, refObject?: Object): void {\r\n    switch (astItem.documentation.releaseTag) {\r\n      case ReleaseTag.None:\r\n      case ReleaseTag.Beta:\r\n      case ReleaseTag.Public:\r\n        break;\r\n      default:\r\n        return; // skip @alpha and @internal definitions\r\n    }\r\n\r\n    super.visit(astItem, refObject);\r\n  }\r\n\r\n  protected visitAstStructuredType(astStructuredType: AstStructuredType, refObject?: Object): void {\r\n    if (!astStructuredType.supportedName) {\r\n      return;\r\n    }\r\n\r\n    const kind: string =\r\n      astStructuredType.kind === AstItemKind.Class ? ApiJsonFile.convertKindToJson(AstItemKind.Class) :\r\n      astStructuredType.kind === AstItemKind.Interface ?\r\n        ApiJsonFile.convertKindToJson(AstItemKind.Interface) : '';\r\n\r\n    const structureNode: Object = {\r\n      kind: kind,\r\n      extends: astStructuredType.extends || '',\r\n      implements: astStructuredType.implements || '',\r\n      typeParameters: astStructuredType.typeParameters || [],\r\n      deprecatedMessage: astStructuredType.documentation.deprecatedMessage || [],\r\n      summary: astStructuredType.documentation.summary || [],\r\n      remarks: astStructuredType.documentation.remarks || [],\r\n      isBeta: astStructuredType.documentation.releaseTag === ReleaseTag.Beta\r\n    };\r\n    refObject[astStructuredType.name] = structureNode;\r\n\r\n    ApiJsonGenerator._methodCounter = 0;\r\n\r\n    const members: AstItem[] = astStructuredType.getSortedMemberItems();\r\n\r\n    if (members && members.length) {\r\n      const membersNode: Object = {};\r\n      structureNode[ApiJsonGenerator._MEMBERS_KEY] = membersNode;\r\n\r\n      for (const astItem of members) {\r\n        this.visit(astItem, membersNode);\r\n      }\r\n    }\r\n  }\r\n\r\n  protected visitAstEnum(astEnum: AstEnum, refObject?: Object): void {\r\n    if (!astEnum.supportedName) {\r\n      return;\r\n    }\r\n\r\n    const valuesNode: Object = {};\r\n    const enumNode: Object = {\r\n      kind: ApiJsonFile.convertKindToJson(astEnum.kind),\r\n      values: valuesNode,\r\n      deprecatedMessage: astEnum.documentation.deprecatedMessage || [],\r\n      summary: astEnum.documentation.summary || [],\r\n      remarks: astEnum.documentation.remarks || [],\r\n      isBeta: astEnum.documentation.releaseTag === ReleaseTag.Beta\r\n    };\r\n    refObject[astEnum.name] = enumNode;\r\n\r\n    for (const astItem of astEnum.getSortedMemberItems()) {\r\n      this.visit(astItem, valuesNode);\r\n    }\r\n  }\r\n\r\n  protected visitAstEnumValue(astEnumValue: AstEnumValue, refObject?: Object): void {\r\n    if (!astEnumValue.supportedName) {\r\n      return;\r\n    }\r\n\r\n    const declaration: ts.Declaration = astEnumValue.getDeclaration();\r\n    const firstToken: ts.Node = declaration ? declaration.getFirstToken() : undefined;\r\n    const lastToken: ts.Node = declaration ? declaration.getLastToken() : undefined;\r\n\r\n    const value: string = lastToken && lastToken !== firstToken ? lastToken.getText() : '';\r\n\r\n    refObject[astEnumValue.name] = {\r\n      kind: ApiJsonFile.convertKindToJson(astEnumValue.kind),\r\n      value: value,\r\n      deprecatedMessage: astEnumValue.documentation.deprecatedMessage || [],\r\n      summary: astEnumValue.documentation.summary || [],\r\n      remarks: astEnumValue.documentation.remarks || [],\r\n      isBeta: astEnumValue.documentation.releaseTag === ReleaseTag.Beta\r\n    };\r\n  }\r\n\r\n  protected visitAstFunction(astFunction: AstFunction, refObject?: Object): void {\r\n    if (!astFunction.supportedName) {\r\n      return;\r\n    }\r\n\r\n    for (const param of astFunction.params) {\r\n      this.visitApiParam(param, astFunction.documentation.parameters[param.name]);\r\n    }\r\n    const returnValueNode: IApiReturnValue = {\r\n      type: astFunction.returnType,\r\n      description: astFunction.documentation.returnsMessage\r\n    };\r\n\r\n    const newNode: Object = {\r\n      kind: ApiJsonFile.convertKindToJson(astFunction.kind),\r\n      returnValue: returnValueNode,\r\n      parameters: astFunction.documentation.parameters,\r\n      deprecatedMessage: astFunction.documentation.deprecatedMessage || [],\r\n      summary: astFunction.documentation.summary || [],\r\n      remarks: astFunction.documentation.remarks || [],\r\n      isBeta: astFunction.documentation.releaseTag === ReleaseTag.Beta\r\n    };\r\n\r\n    refObject[astFunction.name] = newNode;\r\n  }\r\n\r\n  protected visitAstPackage(astPackage: AstPackage, refObject?: Object): void {\r\n    /* tslint:disable:no-string-literal */\r\n    refObject['kind'] = ApiJsonFile.convertKindToJson(astPackage.kind);\r\n    refObject['name'] = astPackage.name;\r\n    refObject['summary'] = astPackage.documentation.summary;\r\n    refObject['remarks'] = astPackage.documentation.remarks;\r\n    /* tslint:enable:no-string-literal */\r\n\r\n    const membersNode: Object = {};\r\n    refObject[ApiJsonGenerator._EXPORTS_KEY] = membersNode;\r\n\r\n    for (const astItem of astPackage.getSortedMemberItems()) {\r\n      this.visit(astItem, membersNode);\r\n    }\r\n  }\r\n\r\n  protected visitAstNamespace(astNamespace: AstNamespace, refObject?: Object): void {\r\n    if (!astNamespace.supportedName) {\r\n      return;\r\n    }\r\n\r\n    const membersNode: Object = {};\r\n    for (const astItem of astNamespace.getSortedMemberItems()) {\r\n      this.visit(astItem, membersNode);\r\n    }\r\n\r\n    const newNode: Object = {\r\n      kind: ApiJsonFile.convertKindToJson(astNamespace.kind),\r\n      deprecatedMessage: astNamespace.documentation.deprecatedMessage || [],\r\n      summary: astNamespace.documentation.summary || [],\r\n      remarks: astNamespace.documentation.remarks || [],\r\n      isBeta: astNamespace.documentation.releaseTag === ReleaseTag.Beta,\r\n      exports: membersNode\r\n    };\r\n\r\n    refObject[astNamespace.name] = newNode;\r\n  }\r\n\r\n  protected visitAstMember(astMember: AstMember, refObject?: Object): void {\r\n    if (!astMember.supportedName) {\r\n      return;\r\n    }\r\n\r\n    refObject[astMember.name] = 'astMember-' + astMember.getDeclaration().kind;\r\n  }\r\n\r\n  protected visitAstProperty(astProperty: AstProperty, refObject?: Object): void {\r\n    if (!astProperty.supportedName) {\r\n      return;\r\n    }\r\n\r\n    if (astProperty.getDeclaration().kind === ts.SyntaxKind.SetAccessor) {\r\n      return;\r\n    }\r\n\r\n    const newNode: Object = {\r\n      kind: ApiJsonFile.convertKindToJson(astProperty.kind),\r\n      isOptional: !!astProperty.isOptional,\r\n      isReadOnly: !!astProperty.isReadOnly,\r\n      isStatic: !!astProperty.isStatic,\r\n      type: astProperty.type,\r\n      deprecatedMessage: astProperty.documentation.deprecatedMessage || [],\r\n      summary: astProperty.documentation.summary || [],\r\n      remarks: astProperty.documentation.remarks || [],\r\n      isBeta: astProperty.documentation.releaseTag === ReleaseTag.Beta\r\n    };\r\n\r\n    refObject[astProperty.name] = newNode;\r\n  }\r\n\r\n  protected visitAstModuleVariable(astModuleVariable: AstModuleVariable, refObject?: Object): void {\r\n    const newNode: Object = {\r\n      kind: ApiJsonFile.convertKindToJson(astModuleVariable.kind),\r\n      type: astModuleVariable.type,\r\n      value: astModuleVariable.value,\r\n      deprecatedMessage: astModuleVariable.documentation.deprecatedMessage || [],\r\n      summary: astModuleVariable.documentation.summary || [],\r\n      remarks: astModuleVariable.documentation.remarks || [],\r\n      isBeta: astModuleVariable.documentation.releaseTag === ReleaseTag.Beta\r\n    };\r\n\r\n    refObject[astModuleVariable.name] = newNode;\r\n  }\r\n\r\n  protected visitAstMethod(astMethod: AstMethod, refObject?: Object): void {\r\n    if (!astMethod.supportedName) {\r\n      return;\r\n    }\r\n\r\n    for (const param of astMethod.params) {\r\n      this.visitApiParam(param, astMethod.documentation.parameters[param.name]);\r\n    }\r\n\r\n    let newNode: Object;\r\n    if (astMethod.name === '__constructor') {\r\n      newNode = {\r\n        kind: ApiJsonFile.convertKindToJson(AstItemKind.Constructor),\r\n        signature: astMethod.getDeclarationLine(),\r\n        parameters: astMethod.documentation.parameters,\r\n        deprecatedMessage: astMethod.documentation.deprecatedMessage || [],\r\n        summary: astMethod.documentation.summary || [],\r\n        remarks: astMethod.documentation.remarks || []\r\n      };\r\n    } else {\r\n      const returnValueNode: IApiReturnValue = {\r\n        type: astMethod.returnType,\r\n        description: astMethod.documentation.returnsMessage\r\n      };\r\n\r\n      newNode = {\r\n        kind: ApiJsonFile.convertKindToJson(astMethod.kind),\r\n        signature: astMethod.getDeclarationLine(),\r\n        accessModifier: astMethod.accessModifier ? ApiAccessModifier[astMethod.accessModifier].toLowerCase() : '',\r\n        isOptional: !!astMethod.isOptional,\r\n        isStatic: !!astMethod.isStatic,\r\n        returnValue: returnValueNode,\r\n        parameters: astMethod.documentation.parameters,\r\n        deprecatedMessage: astMethod.documentation.deprecatedMessage || [],\r\n        summary: astMethod.documentation.summary || [],\r\n        remarks: astMethod.documentation.remarks || [],\r\n        isBeta: astMethod.documentation.releaseTag === ReleaseTag.Beta\r\n      };\r\n    }\r\n\r\n    refObject[astMethod.name] = newNode;\r\n  }\r\n\r\n  protected visitApiParam(astParam: AstParameter, refObject?: Object): void {\r\n    if (!astParam.supportedName) {\r\n      return;\r\n    }\r\n\r\n    if (refObject) {\r\n      (refObject as IApiParameter).isOptional = astParam.isOptional;\r\n      (refObject as IApiParameter).isSpread = astParam.isSpread;\r\n      (refObject as IApiParameter).type = astParam.type;\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\src"}