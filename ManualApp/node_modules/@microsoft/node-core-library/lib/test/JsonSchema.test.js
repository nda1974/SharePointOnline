"use strict";
// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
// See LICENSE in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
/// <reference types='mocha' />
var chai_1 = require("chai");
var path = require("path");
var JsonFile_1 = require("../JsonFile");
var JsonSchema_1 = require("../JsonSchema");
function normalize(text) {
    return text.replace(/[\r\n ]+/g, ' ')
        .trim();
}
describe('JsonSchema', function () {
    var schemaPath = path.resolve(path.join(__dirname, './test-data/test-schema.json'));
    var schema = JsonSchema_1.JsonSchema.fromFile(schemaPath);
    it('loadAndValidate successfully validates a JSON file', function (done) {
        var jsonPath = path.resolve(path.join(__dirname, './test-data/test.json'));
        var jsonObject = JsonFile_1.JsonFile.loadAndValidate(jsonPath, schema);
        chai_1.assert.isObject(jsonObject);
        done();
    });
    it('validateObjectWithCallback successfully reports a compound validation error', function (done) {
        var jsonPath2 = path.resolve(path.join(__dirname, './test-data/test2.json'));
        var jsonObject2 = JsonFile_1.JsonFile.load(jsonPath2);
        var expectedError = "\nError: #/exampleOneOf (Description for exampleOneOf - this i...)\n    Data does not match any schemas from 'oneOf'\nError: #/exampleOneOf (Description for type1)\n      Additional properties not allowed: field2\nError: #/exampleOneOf (Description for type2)\n      Missing required property: field3";
        var errorCount = 0;
        schema.validateObjectWithCallback(jsonObject2, function (errorInfo) {
            ++errorCount;
            console.log(errorInfo.details);
            chai_1.assert.equal(normalize(errorInfo.details), normalize(expectedError), 'Error #' + errorCount.toString());
        });
        chai_1.assert.equal(errorCount, 1);
        done();
    });
});

//# sourceMappingURL=JsonSchema.test.js.map
