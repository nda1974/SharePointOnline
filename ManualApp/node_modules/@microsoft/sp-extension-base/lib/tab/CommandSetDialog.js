var CommandSetDialog = (function () {
    function CommandSetDialog(serverURL) {
        this._serverURL = serverURL;
        this._listName = 'TABTestFieldCustomizerList';
        this._commandItems = [];
    }
    CommandSetDialog.prototype.TestName = function () {
        return 'CommandSet Dialog Test';
    };
    CommandSetDialog.prototype.TestOwner = function () {
        return 'dagaeta';
    };
    CommandSetDialog.prototype.TestIncludeScripts = function () {
        return [
            '<ProductScriptsLocation>msajaxbundle.debug.js',
            '<ProductScriptsLocation>sp.runtime.debug.js',
            '<ProductScriptsLocation>sp.debug.js',
            '<TestLocation>/TabTaskLib.debug.js',
            '<AzureTaskLibLocation>/sp-tab-tasklib.js'
        ];
    };
    CommandSetDialog.prototype.TestSetup = function () {
        TAB.Log.Comment('CommandSet Dialog test start');
        SPTaskLib.ExtensionUtil.loadList(this._listName);
    };
    CommandSetDialog.prototype.TestRun = function () {
        var _this = this;
        var customListPagePath = "/Lists/" + this._listName + "/AllItems.aspx";
        var customActionParams = '{"fd83646f-e2a7-4d7a-8423-85c69ec917fd":' +
            '{"location":"ClientSideExtension.ListViewCommandSet.CommandBar"}}';
        var spQueryParams = {
            loadSPFX: true,
            customActions: customActionParams,
            debugManifestsFile: SPTaskLib.PageUtil.GetDebugManifestsUrl()
        };
        var pageUrl = SPTaskLib.PageUtil.CreatePageUrl(customListPagePath, spQueryParams);
        TAB.AddTask(TAB.LoadPage(pageUrl));
        var listPageReady = TAB.MakeWaiter(function () {
            return TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link').length > 0;
        });
        SPTaskLib.PageUtil.AddTaskClearSecurityDialog(listPageReady);
        TAB.AddTask(TAB.MakeTask(function () {
            TAB.Log.Comment('Validating CommandSet items are set by the ' +
                'CommandSet extension (should be \'Command One\' and \'Command Two\').');
        }), TAB.MakeWaiter(function () {
            var commandLinks = [];
            TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link').forEach(function (value) {
                if (value.innerText.trim() === 'Command One' || value.innerText.trim() === 'Command Two') {
                    commandLinks.push(value);
                }
            });
            return commandLinks.length === 2;
        }));
        TAB.AddTask(TAB.MakeTask(function () {
            var commandItems = TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link');
            var commandItemOne = undefined;
            var commandItemTwo = undefined;
            for (var _i = 0, commandItems_1 = commandItems; _i < commandItems_1.length; _i++) {
                var commandItem = commandItems_1[_i];
                if (commandItem.innerText.trim() === 'Command One') {
                    commandItemOne = commandItem;
                }
                else if (commandItem.innerText.trim() === 'Command Two') {
                    commandItemTwo = commandItem;
                }
            }
            if (!commandItemOne || !commandItemTwo) {
                TAB.Log.AddTaskFail('Command Item titles are incorrect.');
            }
            if (commandItemOne) {
                _this._testCommandItem(commandItemOne, 'Clicked Command One');
            }
            if (commandItemTwo) {
                _this._testCommandItem(commandItemTwo, 'Clicked Command Two. Enter something to alert:');
            }
        }));
        TAB.Log.AddTaskPass('Test complete');
    };
    CommandSetDialog.prototype._testCommandItem = function (commandItem, expectedCommandText) {
        TAB.AddTask(TAB.MakeTask(function () {
            TAB.ClickElement(commandItem);
        }), TAB.MakeWaiter(function () {
            return TAB.ElementExists(TAB.Win, TAB.searchBy.hasClassName, 'ms-Dialog-content');
        }));
        TAB.AddTask(TAB.MakeTask(function () {
            var dialogContent = TAB.GetElement(TAB.Win, TAB.searchBy.hasClassName, 'ms-Dialog-content');
            if (!(dialogContent.innerText.trim() === expectedCommandText)) {
                TAB.Log.AddTaskFail("Command Item One inner context expected to be '" + expectedCommandText + "'.");
            }
        }));
        TAB.AddTask(TAB.MakeTask(function () {
            var dialogActions = TAB.GetElements(TAB.Win, TAB.searchBy.hasClassName, 'ms-Dialog-action');
            for (var _i = 0, dialogActions_1 = dialogActions; _i < dialogActions_1.length; _i++) {
                var dialogAction = dialogActions_1[_i];
                if (dialogAction.innerText.trim() === 'OK') {
                    var okButton = TAB.GetElement(dialogAction, TAB.searchBy.hasClassName, 'ms-Button');
                    TAB.ClickElement(okButton);
                }
            }
        }), TAB.MakeWaiter(function () {
            return !TAB.ElementExists(TAB.Win, TAB.searchBy.hasClassName, 'ms-Dialog-header');
        }));
    };
    return CommandSetDialog;
}());
TabTest = CommandSetDialog;
