var CommandSet = (function () {
    function CommandSet(serverURL) {
        this._serverURL = serverURL;
        this._listName = 'TABTestFieldCustomizerList';
        this._commandItems = [];
    }
    CommandSet.prototype.TestName = function () {
        return 'CommandSet Test';
    };
    CommandSet.prototype.TestOwner = function () {
        return 'dagaeta';
    };
    CommandSet.prototype.TestIncludeScripts = function () {
        return [
            '<ProductScriptsLocation>msajaxbundle.debug.js',
            '<ProductScriptsLocation>sp.runtime.debug.js',
            '<ProductScriptsLocation>sp.debug.js',
            '<TestLocation>/TabTaskLib.debug.js',
            '<AzureTaskLibLocation>/sp-tab-tasklib.js'
        ];
    };
    CommandSet.prototype.TestSetup = function () {
        TAB.Log.Comment('CommandSet test start');
        SPTaskLib.ExtensionUtil.loadList(this._listName);
    };
    CommandSet.prototype.TestRun = function () {
        var _this = this;
        var customListPagePath = "/Lists/" + this._listName + "/AllItems.aspx";
        var customActionParams = '{"1516565a-1785-4cb4-b339-79f104f88d22":' +
            '{"location":"ClientSideExtension.ListViewCommandSet.CommandBar"}}';
        var spQueryParams = {
            loadSPFX: true,
            customActions: customActionParams,
            debugManifestsFile: SPTaskLib.PageUtil.GetDebugManifestsUrl()
        };
        var pageUrl = SPTaskLib.PageUtil.CreatePageUrl(customListPagePath, spQueryParams);
        TAB.AddTask(TAB.LoadPage(pageUrl));
        var listPageReady = TAB.MakeWaiter(function () {
            return TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link').length > 0;
        });
        SPTaskLib.PageUtil.AddTaskClearSecurityDialog(listPageReady);
        TAB.AddTask(TAB.MakeTask(function () {
            TAB.Log.Comment('Validating CommandSet items are set by the ' +
                'CommandSet extension (should be \'Command One\' and \'Command Two\').');
        }), TAB.MakeWaiter(function () {
            var commandLinks = [];
            TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link').forEach(function (value) {
                if (value.innerText.trim() === 'Command One' || value.innerText.trim() === 'Command Two') {
                    commandLinks.push(value);
                }
            });
            return commandLinks.length === 2;
        }));
        TAB.AddTask(TAB.MakeTask(function () {
            var commandItems = TAB.GetElements(TAB.Win, TAB.searchBy.className, 'CommandBarItem-link');
            var commandItemOne = undefined;
            var commandItemTwo = undefined;
            for (var _i = 0, commandItems_1 = commandItems; _i < commandItems_1.length; _i++) {
                var commandItem = commandItems_1[_i];
                if (commandItem.innerText.trim() === 'Command One') {
                    commandItemOne = commandItem;
                }
                else if (commandItem.innerText.trim() === 'Command Two') {
                    commandItemTwo = commandItem;
                }
            }
            if (!commandItemOne || !commandItemTwo) {
                TAB.Log.AddTaskFail('Command Item titles are incorrect.');
            }
            if (commandItemOne) {
                _this._testCommandItem(commandItemOne, 'CommandOneDiv');
            }
            if (commandItemTwo) {
                _this._testCommandItem(commandItemTwo, 'CommandTwoDiv');
            }
        }));
        TAB.Log.AddTaskPass('Test complete');
    };
    CommandSet.prototype._testCommandItem = function (commandItem, dataAutomationId) {
        TAB.AddTask(TAB.MakeTask(function () {
            TAB.Log.Comment('Validating div has not been added before clicking the Command Item.');
        }), TAB.MakeWaiter(function () {
            return !TAB.ElementExists(TAB.Win, TAB.searchBy.customQuery, "[data-automation-id=\"" + dataAutomationId + "\"]");
        }));
        TAB.AddTask(TAB.MakeTask(function () {
            TAB.Log.Comment('Validating div is added to HTML after clicking the Command Item.');
            TAB.ClickElement(commandItem);
        }), TAB.MakeWaiter(function () {
            return TAB.ElementExists(TAB.Win, TAB.searchBy.customQuery, "[data-automation-id=\"" + dataAutomationId + "\"]");
        }));
    };
    return CommandSet;
}());
TabTest = CommandSet;
