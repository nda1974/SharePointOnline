{"version":3,"file":"ScrollablePane.js","sourceRoot":"../src/","sources":["components/ScrollablePane/ScrollablePane.tsx"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:no-unused-variable */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\n/* tslint:enable:no-unused-variable */\nimport * as PropTypes from 'prop-types';\nimport {\n  autobind,\n  BaseComponent,\n  css\n} from '../../Utilities';\nimport { IScrollablePaneProps } from './ScrollablePane.Props';\nimport { Sticky } from '../../Sticky';\nimport * as stylesImport from './ScrollablePane.scss';\nconst styles: any = stylesImport;\n\nexport interface IScrollablePaneContext {\n  scrollablePane: PropTypes.Requireable<object>;\n}\n\nexport class ScrollablePane extends BaseComponent<IScrollablePaneProps, {}> {\n  public static childContextTypes: IScrollablePaneContext = {\n    scrollablePane: PropTypes.object\n  };\n\n  public refs: {\n    root: HTMLElement;\n    stickyContainer: HTMLElement;\n    stickyAbove: HTMLElement;\n    stickyBelow: HTMLElement;\n  };\n\n  private _subscribers: Set<Function>;\n  private _stickyAbove: Set<Sticky>;\n  private _stickyBelow: Set<Sticky>;\n\n  constructor(props: IScrollablePaneProps) {\n    super(props);\n    this._subscribers = new Set<Function>();\n    this._stickyAbove = new Set<Sticky>();\n    this._stickyBelow = new Set<Sticky>();\n  }\n\n  public getChildContext() {\n    return {\n      scrollablePane: {\n        subscribe: this.subscribe,\n        unsubscribe: this.unsubscribe,\n        addStickyHeader: this.addStickyHeader,\n        removeStickyHeader: this.removeStickyHeader,\n        addStickyFooter: this.addStickyFooter,\n        removeStickyFooter: this.removeStickyFooter,\n        notifySubscribers: this.notifySubscribers\n      }\n    };\n  }\n\n  public componentDidMount() {\n    const { root, stickyContainer, stickyAbove, stickyBelow } = this.refs;\n\n    this._events.on(root, 'scroll', this.notifySubscribers);\n    this._events.on(window, 'resize', this._onWindowResize);\n    setTimeout(() => {\n      this._resizeContainer();\n      if (stickyContainer.parentElement && root.parentElement) {\n        stickyContainer.parentElement.removeChild(stickyContainer);\n        root.parentElement.insertBefore(stickyContainer, root.nextSibling);\n        this.notifySubscribers();\n      }\n    }, 500);\n  }\n\n  public componentWillUnmount() {\n    const { stickyContainer } = this.refs;\n    this._events.off(this.refs.root);\n    this._events.off(window);\n    if (stickyContainer.parentElement) {\n      stickyContainer.parentElement.removeChild(stickyContainer);\n    }\n  }\n\n  public render() {\n    const { className } = this.props;\n\n    return (\n      <div\n        ref='root'\n        className={ css('ms-ScrollablePane', styles.root, className) }\n        data-is-scrollable={ true }>\n        <div ref='stickyContainer' className={ styles.stickyContainer }>\n          <div ref='stickyAbove' className={ styles.stickyAbove } />\n          <div ref='stickyBelow' className={ styles.stickyBelow } />\n        </div>\n        { this.props.children }\n      </div>\n    );\n  }\n\n  @autobind\n  public subscribe(handler: (headerBound: ClientRect, footerBound: ClientRect) => void) {\n    this._subscribers.add(handler);\n  }\n\n  @autobind\n  public unsubscribe(handler: (headerBound: ClientRect, footerBound: ClientRect) => void) {\n    this._subscribers.delete(handler);\n  }\n\n  @autobind\n  public addStickyHeader(sticky: Sticky) {\n    const { stickyAbove } = this.refs;\n    this._addSticky(sticky, this._stickyAbove, stickyAbove, () => {\n      stickyAbove.appendChild(sticky.content);\n    });\n  }\n\n  @autobind\n  public addStickyFooter(sticky: Sticky) {\n    const { stickyBelow } = this.refs;\n    this._addSticky(sticky, this._stickyBelow, stickyBelow, () => {\n      stickyBelow.insertBefore(sticky.content, stickyBelow.firstChild);\n    });\n  }\n\n  @autobind\n  public removeStickyHeader(sticky: Sticky) {\n    this._removeSticky(sticky, this._stickyAbove, this.refs.stickyAbove);\n  }\n\n  @autobind\n  public removeStickyFooter(sticky: Sticky) {\n    this._removeSticky(sticky, this._stickyBelow, this.refs.stickyBelow);\n  }\n\n  @autobind\n  public notifySubscribers(sort?: boolean): void {\n    const { stickyAbove, stickyBelow } = this.refs;\n    this._subscribers.forEach((handle) => {\n      handle(stickyAbove.getBoundingClientRect(), stickyBelow.getBoundingClientRect());\n    });\n    if (this._stickyAbove.size > 1) {\n      this._sortStickies(this._stickyAbove, stickyAbove);\n    }\n    if (this._stickyBelow.size > 1) {\n      this._sortStickies(this._stickyBelow, stickyBelow);\n    }\n  }\n\n  private _addSticky(sticky: Sticky, stickyList: Set<Sticky>, container: HTMLElement, addStickyToContainer: () => void) {\n    if (!stickyList.has(sticky)) {\n      stickyList.add(sticky);\n      addStickyToContainer();\n      sticky.content.addEventListener('transitionend',\n        this._setPlaceholderHeights.bind(null, stickyList),\n        false);\n      if (sticky.props.stickyClassName) {\n        setTimeout(() => {\n          if (sticky.props.stickyClassName) {\n            sticky.content.children[0].classList.add(sticky.props.stickyClassName);\n          }\n        }, 1);\n      }\n      this.notifySubscribers();\n      this._setPlaceholderHeights(stickyList);\n    }\n  }\n\n  private _removeSticky(sticky: Sticky, stickyList: Set<Sticky>, container: HTMLElement) {\n    if (stickyList.has(sticky)) {\n      sticky.content.removeEventListener('transitionend',\n        this._setPlaceholderHeights.bind(null, stickyList, container));\n      stickyList.delete(sticky);\n    }\n  }\n\n  private _onWindowResize() {\n    const { stickyAbove, stickyBelow } = this.refs;\n    setTimeout(() => {\n      this._resizeContainer();\n      this.notifySubscribers();\n      this._setPlaceholderHeights(this._stickyAbove);\n      this._setPlaceholderHeights(this._stickyBelow);\n    }, 5);\n  }\n\n  private _resizeContainer() {\n    const { stickyContainer, root } = this.refs;\n    const { borderTopWidth, borderLeftWidth } = getComputedStyle(root);\n    stickyContainer.style.height = root.clientHeight + 'px';\n    stickyContainer.style.width = root.clientWidth + 'px';\n    if (borderTopWidth) {\n      stickyContainer.style.top = root.offsetTop + parseInt(borderTopWidth, 10) + 'px';\n    }\n    if (borderLeftWidth) {\n      stickyContainer.style.left = root.offsetLeft + parseInt(borderLeftWidth, 10) + 'px';\n    }\n  }\n\n  @autobind\n  private _setPlaceholderHeights(stickies: Set<Sticky>) {\n    stickies.forEach((sticky, idx) => {\n      sticky.setPlaceholderHeight(sticky.content.clientHeight);\n    });\n  }\n\n  private _sortStickies(stickyList: Set<Sticky>, container: HTMLElement): void {\n    let stickyArr = Array.from(stickyList);\n    stickyArr = stickyArr.sort((a, b) => {\n      return a.refs.root.offsetTop - b.refs.root.offsetTop;\n    });\n    while (container.lastChild) {\n      container.removeChild(container.lastChild);\n    }\n    stickyArr.forEach((sticky) => {\n      container.appendChild(sticky.content);\n    });\n  }\n}"]}