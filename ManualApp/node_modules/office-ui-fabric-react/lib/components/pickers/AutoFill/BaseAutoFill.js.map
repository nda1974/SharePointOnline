{"version":3,"file":"BaseAutoFill.js","sourceRoot":"../src/","sources":["components/pickers/AutoFill/BaseAutoFill.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { IBaseAutoFillProps, IBaseAutoFill } from './BaseAutoFill.Props';\nimport {\n  BaseComponent,\n  KeyCodes,\n  autobind,\n  getNativeProps,\n  inputProperties\n} from '../../../Utilities';\n\nexport interface IBaseAutoFillState {\n  displayValue?: string;\n}\n\nconst SELECTION_FORWARD = 'forward';\nconst SELECTION_BACKWARD = 'backward';\n\nexport class BaseAutoFill extends BaseComponent<IBaseAutoFillProps, IBaseAutoFillState> implements IBaseAutoFill {\n\n  public static defaultProps = {\n    enableAutoFillOnKeyPress: [KeyCodes.down, KeyCodes.up]\n  };\n\n  private _inputElement: HTMLInputElement;\n  private _autoFillEnabled: boolean = true;\n  private _value: string;\n\n  constructor(props: IBaseAutoFillProps) {\n    super(props);\n    this._value = '';\n    this.state = {\n      displayValue: props.defaultVisibleValue === null ? '' : props.defaultVisibleValue\n    };\n  }\n\n  public get cursorLocation(): number {\n    if (this._inputElement) {\n      let inputElement = this._inputElement;\n      if (inputElement.selectionDirection !== SELECTION_FORWARD) {\n        return inputElement.selectionEnd;\n      } else {\n        return inputElement.selectionStart;\n      }\n    } else {\n      return -1;\n    }\n  }\n\n  public get isValueSelected(): boolean {\n    return this.inputElement.selectionStart !== this.inputElement.selectionEnd;\n  }\n\n  public get value(): string {\n    return this._value;\n  }\n\n  public get selectionStart(): number {\n    return this._inputElement ? this._inputElement.selectionStart : -1;\n  }\n\n  public get selectionEnd(): number {\n    return this._inputElement ? this._inputElement.selectionEnd : -1;\n  }\n\n  public get inputElement(): HTMLInputElement {\n    return this._inputElement;\n  }\n\n  public componentWillReceiveProps(nextProps: IBaseAutoFillProps) {\n    let newValue;\n\n    if (this.props.updateValueInWillReceiveProps) {\n      newValue = this.props.updateValueInWillReceiveProps();\n    }\n\n    if (this._autoFillEnabled && this._doesTextStartWith(nextProps.suggestedDisplayValue!, newValue ? newValue : this._value)) {\n      newValue = nextProps.suggestedDisplayValue;\n    }\n\n    if (typeof newValue === 'string') {\n      this.setState({ displayValue: newValue });\n    }\n  }\n\n  public componentDidUpdate() {\n    let value = this._value;\n    let {\n      suggestedDisplayValue,\n      shouldSelectFullInputValueInComponentDidUpdate\n    } = this.props;\n    let differenceIndex = 0;\n\n    if (this._autoFillEnabled && value && suggestedDisplayValue && this._doesTextStartWith(suggestedDisplayValue, value)) {\n      let shouldSelectFullRange = false;\n\n      if (shouldSelectFullInputValueInComponentDidUpdate) {\n        shouldSelectFullRange = shouldSelectFullInputValueInComponentDidUpdate();\n      }\n\n      if (shouldSelectFullRange) {\n        this._inputElement.setSelectionRange(0, suggestedDisplayValue.length, SELECTION_BACKWARD);\n      } else {\n        while (differenceIndex < value.length && value[differenceIndex].toLocaleLowerCase() === suggestedDisplayValue[differenceIndex].toLocaleLowerCase()) {\n          differenceIndex++;\n        }\n        if (differenceIndex > 0) {\n          this._inputElement.setSelectionRange(differenceIndex, suggestedDisplayValue.length, SELECTION_BACKWARD);\n        }\n      }\n    }\n  }\n\n  public render() {\n    let {\n      displayValue\n    } = this.state;\n\n    const nativeProps = getNativeProps(this.props, inputProperties);\n    return <input { ...nativeProps}\n      ref={ this._resolveRef('_inputElement') }\n      value={ displayValue }\n      autoCapitalize={ 'off' }\n      autoComplete={ 'off' }\n      onChange={ this._onChange }\n      onKeyDown={ this._onKeyDown }\n      onClick={ this.props.onClick ? this.props.onClick : this._onClick }\n    />;\n  }\n\n  public focus() {\n    this._inputElement.focus();\n  }\n\n  public clear() {\n    this._autoFillEnabled = true;\n    this._updateValue('');\n    this._inputElement.setSelectionRange(0, 0);\n  }\n\n  @autobind\n  private _onClick() {\n    if (this._value && this._value !== '' && this._autoFillEnabled) {\n      this._autoFillEnabled = false;\n    }\n  }\n\n  @autobind\n  private _onKeyDown(ev: React.KeyboardEvent<HTMLInputElement>) {\n    if (this.props.onKeyDown) {\n      this.props.onKeyDown(ev);\n    }\n\n    switch (ev.which) {\n      case KeyCodes.backspace:\n        this._autoFillEnabled = false;\n        break;\n      case KeyCodes.left:\n        if (this._autoFillEnabled) {\n          this._autoFillEnabled = false;\n        }\n        break;\n      case KeyCodes.right:\n        if (this._autoFillEnabled) {\n          this._autoFillEnabled = false;\n        }\n        break;\n      default:\n        if (!this._autoFillEnabled) {\n          if (this.props.enableAutoFillOnKeyPress!.indexOf(ev.which) !== -1) {\n            this._autoFillEnabled = true;\n          }\n        }\n        break;\n    }\n  }\n\n  @autobind\n  private _onChange(ev: React.FormEvent<HTMLElement>) {\n    let value: string = (ev.target as HTMLInputElement).value;\n    if (value && (ev.target as HTMLInputElement).selectionStart === value.length && !this._autoFillEnabled && value.length > this._value.length) {\n      this._autoFillEnabled = true;\n    }\n    this._updateValue(value);\n  }\n\n  private _notifyInputChange(newValue: string) {\n    if (this.props.onInputValueChange) {\n      this.props.onInputValueChange(newValue);\n    }\n  }\n\n  private _updateValue(newValue: string) {\n    this._value = newValue;\n    let displayValue = newValue;\n    if (this.props.suggestedDisplayValue &&\n      this._doesTextStartWith(this.props.suggestedDisplayValue, displayValue)\n      && this._autoFillEnabled) {\n      displayValue = this.props.suggestedDisplayValue;\n    }\n    this.setState({\n      displayValue: newValue\n    }, () => this._notifyInputChange(newValue));\n  }\n\n  private _doesTextStartWith(text: string, startWith: string) {\n    if (!text || !startWith) {\n      return false;\n    }\n    return text.toLocaleLowerCase().indexOf(startWith.toLocaleLowerCase()) === 0;\n  }\n}"]}