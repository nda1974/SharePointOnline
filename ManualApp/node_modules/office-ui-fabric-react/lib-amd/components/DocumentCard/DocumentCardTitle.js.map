{"version":3,"file":"DocumentCardTitle.js","sourceRoot":"../src/","sources":["components/DocumentCard/DocumentCardTitle.tsx"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:no-unused-variable */\nimport * as React from 'react';\n/* tslint:enable:no-unused-variable */\n\nimport {\n  BaseComponent,\n  autobind,\n  css\n} from '../../Utilities';\nimport { IDocumentCardTitleProps } from './DocumentCard.Props';\nimport * as stylesImport from './DocumentCard.scss';\nconst styles: any = stylesImport;\n\nexport interface IDocumentCardTitleState {\n  truncatedTitleFirstPiece?: string;\n  truncatedTitleSecondPiece?: string;\n}\n\nconst TRUNCATION_SEPARATOR = '&hellip;';\nconst TRUNCATION_MINIMUM_LENGTH = 40; // This is the length we know can fit into the min width of DocumentCard.\nconst TRUNCATION_MAXIMUM_LENGTH = 90 - TRUNCATION_SEPARATOR.length;\nconst TRUNCATION_FIRST_PIECE_LONGER_BY = 10;\nconst TRUNCATION_VERTICAL_OVERFLOW_THRESHOLD = 5;\n\nexport class DocumentCardTitle extends BaseComponent<IDocumentCardTitleProps, IDocumentCardTitleState> {\n  private _titleElement: HTMLDivElement;\n  private _scrollTimerId: number;\n  private _truncatedTitleAtWidth: number;\n  private _isTruncated: boolean;\n\n  constructor(props: IDocumentCardTitleProps) {\n    super(props);\n\n    this.state = {\n      truncatedTitleFirstPiece: '',\n      truncatedTitleSecondPiece: ''\n    };\n  }\n\n  public componentDidMount() {\n    let { title, shouldTruncate } = this.props;\n    if (shouldTruncate && title && title.length > TRUNCATION_MINIMUM_LENGTH) {\n      if (this._doesTitleOverflow()) {\n        this._startTruncation(this.props);\n      }\n      this._events.on(window, 'resize', this._updateTruncation);\n    }\n  }\n\n  public componentWillReceiveProps(newProps: IDocumentCardTitleProps) {\n    this._events.off(window, 'resize');\n    this._isTruncated = false;\n\n    if (newProps.shouldTruncate && newProps.title && newProps.title.length > TRUNCATION_MINIMUM_LENGTH) {\n      this._startTruncation(newProps);\n      this._events.on(window, 'resize', this._updateTruncation);\n    }\n  }\n\n  public componentDidUpdate() {\n    // If we're truncating, make sure the title fits\n    if (this.props.shouldTruncate) {\n      this._shrinkTitle();\n    }\n  }\n\n  public render() {\n    let { title, shouldTruncate } = this.props;\n    let { truncatedTitleFirstPiece, truncatedTitleSecondPiece } = this.state;\n\n    let documentCardTitle;\n    if (shouldTruncate && this._isTruncated) {\n      documentCardTitle = (\n        <div className={ css('ms-DocumentCardTitle', styles.title) } ref={ this._resolveRef('_titleElement') } title={ title }>{ truncatedTitleFirstPiece }&hellip;{ truncatedTitleSecondPiece }</div>\n      );\n    } else {\n      documentCardTitle = (\n        <div className={ css('ms-DocumentCardTitle', styles.title) } ref={ this._resolveRef('_titleElement') } title={ title }>{ title }</div>\n      );\n    }\n\n    return documentCardTitle;\n  }\n\n  @autobind\n  private _startTruncation(props: IDocumentCardTitleProps) {\n    let originalTitle = props.title;\n    this._isTruncated = false;\n\n    // If the title is really short, there's no need to truncate it\n    if (originalTitle && originalTitle.length >= TRUNCATION_MINIMUM_LENGTH) {\n\n      // Break the text into two pieces for assembly later\n      if (originalTitle.length > TRUNCATION_MAXIMUM_LENGTH) {\n        // The text is really long, so we can take a chunk out of the middle so the two pieces combine for the maximum length\n        this._isTruncated = true;\n        this.setState({\n          truncatedTitleFirstPiece: originalTitle.slice(0, TRUNCATION_MAXIMUM_LENGTH / 2 + TRUNCATION_FIRST_PIECE_LONGER_BY),\n          truncatedTitleSecondPiece: originalTitle.slice(originalTitle.length - (TRUNCATION_MAXIMUM_LENGTH / 2 - TRUNCATION_FIRST_PIECE_LONGER_BY))\n        });\n      } else {\n        // The text is not so long, so we'll just break it into two pieces\n        this.setState({\n          truncatedTitleFirstPiece: originalTitle.slice(0, Math.ceil(originalTitle.length / 2) + TRUNCATION_FIRST_PIECE_LONGER_BY),\n          truncatedTitleSecondPiece: originalTitle.slice(originalTitle.length - Math.floor(originalTitle.length / 2) + TRUNCATION_FIRST_PIECE_LONGER_BY)\n        });\n      }\n    }\n\n    // Save the width we just started truncation at, so that later we will only update truncation if necessary\n    this._truncatedTitleAtWidth = this._titleElement.clientWidth;\n\n  }\n\n  private _shrinkTitle() {\n    if (this._doesTitleOverflow()) {\n      let { truncatedTitleFirstPiece, truncatedTitleSecondPiece } = this.state;\n      this._isTruncated = true;\n\n      if (!truncatedTitleFirstPiece && !truncatedTitleSecondPiece) {\n        this._startTruncation(this.props);\n      }\n\n      this.setState({\n        truncatedTitleFirstPiece: truncatedTitleFirstPiece!.slice(0, truncatedTitleFirstPiece!.length - 1),\n        truncatedTitleSecondPiece: truncatedTitleSecondPiece!.slice(1)\n      });\n    }\n  }\n\n  private _doesTitleOverflow(): boolean {\n    let titleElement = this._titleElement;\n    return titleElement.scrollHeight > titleElement.clientHeight + TRUNCATION_VERTICAL_OVERFLOW_THRESHOLD || titleElement.scrollWidth > titleElement.clientWidth;\n  }\n\n  private _updateTruncation() {\n    // Only update truncation if the title's size has changed since the last time we truncated\n    if (this._titleElement.clientWidth !== this._truncatedTitleAtWidth) {\n      // Throttle truncation so that it doesn't happen during a window resize\n      clearTimeout(this._scrollTimerId);\n      this._scrollTimerId = this._async.setTimeout(this._startTruncation.bind(this, this.props), 250);\n    }\n  }\n\n}\n"]}